<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WAGUWAGU Login</title>

    <!-- ê¸°ì¡´ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="../styles/main.css" />
    <link rel="stylesheet" href="../styles/ranking.css" />

    <!-- Google Identity Services SDK -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- ë‹‰ë„¤ì„ ì¹´ë“œ ê¸°ë³¸ ìˆ¨ê¹€ -->
    <style>
      #app {
        display: none;
      }
    </style>
  </head>

  <body class="mode-main">
    <!-- ì¢Œ(ë­í‚¹) + ìš°(íˆì–´ë¡œ) ë ˆì´ì•„ì›ƒ -->
    <div id="layout">
      <aside id="ranking-panel">
        <h2>WEEKLY TOP 10</h2>
        <div id="ranking-list">
          <div class="empty-ranking">ë¡œë”© ì¤‘...</div>
          <!-- JSë¡œ .ranking-item 10ê°œë¥¼ ë„£ëŠ” êµ¬ì¡° -->
        </div>
      </aside>

      <main id="main-screen">
        <!-- ë°°ê²½ + ì¤‘ì•™ì •ë ¬ ê¸°ì¤€ íˆì–´ë¡œ -->
        <section id="hero">
          <div id="center-area">
            <div id="game-title">WAGUWAGU</div>

            <!-- êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼ ì˜ì—­ -->
            <div id="google-login-area"></div>

            <!-- OAuth ì´í›„ ì‹ ê·œ ìœ ì €ë§Œ ì“°ëŠ” ë‹‰ë„¤ì„ ì¹´ë“œ -->
            <div id="app">
              <input
                type="text"
                id="nickname-input"
                placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
              />
              <button id="start-button">ì¤€ë¹„ ì™„ë£Œ</button>
              <p id="status-message"></p>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- ğŸ”¥ ë¡œê·¸ì¸ ë¡œì§ -->
    <script type="module">
      import { googleLogin } from "../api/google-login-api.js";
      import { MATCHING_CONFIG } from "../../config.js";

      //ì´ë¯¸ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìë¼ë©´, homeìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
      const token = localStorage.getItem("accessToken");
      if (token) {
        location.href = "./home.html";
      }

      window.onload = () => {
        google.accounts.id.initialize({
          client_id: MATCHING_CONFIG.GOOGLE_CLIENT_ID,
          callback: async (response) => {
            try {
              const data = await googleLogin(response.credential);

              localStorage.setItem("accessToken", data.accessToken);
              localStorage.setItem("googlesub", data.googleSub);

              if (data.isNewUser) {
                // ì‹ ê·œ ìœ ì € â†’ ë‹‰ë„¤ì„ ì…ë ¥ UI í™œì„±í™”
                document.getElementById("app").style.display = "block";
                document.getElementById("google-login-area").style.display =
                  "none";
              } else {
                // ê¸°ì¡´ ìœ ì € â†’ ë°”ë¡œ í™ˆìœ¼ë¡œ (ë‹‰ë„¤ì„ í™•ì¸ìš©)
                location.href = "./home.html";
              }
            } catch (e) {
              alert(e.message);
            }
          },
        });

        google.accounts.id.renderButton(
          document.getElementById("google-login-area"),
          {
            theme: "outline",
            size: "large",
          }
        );
      };
    </script>

    <!-- ê¸°ì¡´ ë‹‰ë„¤ì„/ê²Œì„ ì‹œì‘ ë¡œì§ -->
    <script type="module" src="../js/login.js"></script>
  </body>
</html>
