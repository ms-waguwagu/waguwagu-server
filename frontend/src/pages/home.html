<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WAGUWAGU Home</title>

    <!-- ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš© -->
    <link rel="stylesheet" href="../styles/main.css" />
    <link rel="stylesheet" href="../styles/ranking.css" />
  </head>

  <body class="mode-main">
    <div id="layout">
      <!-- ì¢Œì¸¡ ë­í‚¹ -->
      <aside id="ranking-panel">
        <h2>WEEKLY TOP 10</h2>
        <div id="ranking-list">
          <div class="empty-ranking">ë¡œë”© ì¤‘...</div>
        </div>
      </aside>

      <!-- ìš°ì¸¡ ë©”ì¸ -->
      <main id="main-screen">
        <section id="hero">
          <div id="center-area">
            <div id="game-title">WAGUWAGU</div>

            <div id="app">
              <button id="start-button">ê²Œì„ ì‹œì‘</button>
              <button id="boss-start-button">ë³´ìŠ¤ í…ŒìŠ¤íŠ¸</button>
              <button id="logout-button">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script type="module">
      import { CONFIG } from "../../config.js";

      // ë¡œê·¸ì¸ ìœ ì§€ ì²´í¬
      const token = localStorage.getItem("accessToken");
      if (!token) {
        location.href = "./login.html";
      }

        // ğŸ§¹ í™ˆ ì§„ì… ì‹œ ê²Œì„ ì”ì¡´ ì •ë³´ ì •ë¦¬
      localStorage.removeItem("waguwagu_room_id");

      // ê²Œì„ ì‹œì‘
      document.getElementById("start-button").onclick = () => {
        location.href = "./queue.html";
      };

      // ë³´ìŠ¤ í…ŒìŠ¤íŠ¸
      document.getElementById("boss-start-button").onclick = () => {
        location.href = "./login.html"; // í•„ìš” ì‹œ ë³´ìŠ¤ ì „ìš© í˜ì´ì§€ë¡œ ë³€ê²½
      };

      // ë¡œê·¸ì•„ì›ƒ
      document.getElementById("logout-button").onclick = () => {
        localStorage.clear();
        location.href = "./login.html";
      };

      // ë­í‚¹ ë¡œë“œ (login.htmlê³¼ ë™ì¼ ë¡œì§)
      async function loadRanking() {
        try {
          const res = await fetch(CONFIG.API_URL + "/ranking/top");
          const data = await res.json();

          const list = document.getElementById("ranking-list");
          if (!data || data.length === 0) {
            list.innerHTML = "<div class='empty-ranking'>ë°ì´í„° ì—†ìŒ</div>";
            return;
          }

          list.innerHTML = data
            .map(
              (item) => `
              <div class="ranking-item">
                <div class="rank">${item.rank}</div>
                <div class="nick">${item.nickname}</div>
                <div class="score">${item.score}</div>
              </div>
            `
            )
            .join("");
        } catch (e) {
          document.getElementById("ranking-list").innerHTML =
            "<div class='empty-ranking'>ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨</div>";
        }
      }

      loadRanking();
      setInterval(loadRanking, 30000);
    </script>
  </body>
</html>
