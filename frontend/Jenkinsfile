pipeline {
  agent any

  environment {
    AWS_REGION = "ap-northeast-2"
    S3_BUCKET  = "waguwagu-s3-bucket-061039804626-ap-northeast-2"
  }

  stages {
    stage('Checkout') {
      steps { checkout scm }
    }

    stage('Deploy to S3 (include src/)') {
      steps {
        sh '''
          set -eux
          DEST="s3://$S3_BUCKET/"

          aws s3 sync "frontend/" "$DEST" --delete --region "$AWS_REGION"

          # index.html만 no-cache로 다시 업로드(브라우저 캐시 완화)
          aws s3 cp "frontend/index.html" "${DEST}index.html" --region "$AWS_REGION" \
            --cache-control "no-cache, no-store, must-revalidate" \
            --content-type "text/html; charset=utf-8" \
            --metadata-directive REPLACE
        '''
      }
    }
  }
}
