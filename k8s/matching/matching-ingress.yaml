apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: matching-ingress
  namespace: matching
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip

    # [ê¸°ì¡´ ì„¤ì • ìœ ì§€] í¬íŠ¸ ë° SSL ë¦¬ë‹¤ì´ë ‰íŠ¸
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS":443}]'
    alb.ingress.kubernetes.io/actions.ssl-redirect: '{"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}'
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-2:061039804626:certificate/1f543a12-9774-4f4a-a5a5-94f1f600afaa
    # alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-2:269397878198:certificate/1f543a12-9774-4f4a-a5a5-94f1f600afaa ë‚´ ê³„ì • ì£¼ì„

    # ğŸ‘‡ [ì¶”ê°€ 1] CORS ì„¤ì • (ì´ê²Œ ìˆì–´ì•¼ í”„ë¡ íŠ¸ì—”ë“œê°€ ì ‘ì† ê°€ëŠ¥!)
    alb.ingress.kubernetes.io/cors-allow-methods: GET, POST, PUT, DELETE, PATCH, OPTIONS
    alb.ingress.kubernetes.io/cors-allow-origin: "*"
    alb.ingress.kubernetes.io/cors-allow-headers: "*"

    # ğŸ‘‡ [ì¶”ê°€ 2] í—¬ìŠ¤ ì²´í¬ ê²½ë¡œ (Deployment ì„¤ì •ê³¼ ì¼ì¹˜ì‹œí‚¤ê¸°)
    # ì´ê±¸ ì•ˆ ë„£ìœ¼ë©´ ë¡œë“œë°¸ëŸ°ì„œê°€ ì„œë²„ë¥¼ 'ë¹„ì •ìƒ'ìœ¼ë¡œ íŒë‹¨í•´ 502 ì—ëŸ¬ë¥¼ ë‚¼ ìˆ˜ ìˆìŒ
    alb.ingress.kubernetes.io/healthcheck-path: /api/matching/health
    alb.ingress.kubernetes.io/success-codes: "200"

spec:
  ingressClassName: alb
  rules:
    - host: matching.waguwagu.cloud
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: ssl-redirect
                port:
                  name: use-annotation
          - path: /
            pathType: Prefix
            backend:
              service:
                name: matching-svc
                port:
                  number: 80
