# 개발/연결 테스트용으로 단독 생성할 때 쓰는 파일
apiVersion: "agones.dev/v1"
kind: GameServer
metadata:
  name: waguwagu-gs
  labels:
    app: waguwagu
    mode: room-per-pod
spec:
  # ports: 게임 클라이언트가 직접 붙는 포트 정의
  # portPolicy: Dynamic이면 호스트 포트(hostPort)를 Agones가 자동 할당
  ports:
    - name: game
      portPolicy: Dynamic
      containerPort: 3001
      protocol: TCP  # 기본은 UDP. 게임이 WebSocket이면 TCP가 보통.

  # health: SDK Health() 호출 기반 헬스 체크 설정
  health:
    disabled: false
    initialDelaySeconds: 10
    periodSeconds: 5
    failureThreshold: 3

  # sdkServer: Agones SDK 사이드카 로그 레벨
  sdkServer:
    logLevel: Info

  # 실제 Pod 템플릿
  template:
    metadata:
      labels:
        app: waguwagu
        role: gameserver
    spec:
      terminationGracePeriodSeconds: 30
      containers:
        - name: game-server
          image: <YOUR_ECR_IMAGE:TAG> # TODO: ECR 이미지로 변경
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 3001
          env:
            - name: GAME_PORT
              value: "3001"
          resources:
            requests:
              cpu: "250m"
              memory: "256Mi"
            limits:
              cpu: "1000m"
              memory: "1Gi"
